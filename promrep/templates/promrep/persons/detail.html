{% extends "base.html" %}
{% load ddh_utils_tags staticfiles wagtailbase_tags wagtailcore_tags %}

{% block meta_title %}Person Details{% endblock %}

{% block main %}

<div class="row">
    <div class="large-12 columns">

      <h2>{{ person }}</h2>

      <p>
          Project ID: {{ person.id }}
      </p>

      {% if person.patrician %}
      <p>
          Patrician{% if person.patrician_uncertainty %}?{% endif %}
      </p>
      {% endif %}

      {% if person.gens %}
      <p>
          Gens: {{ person.gens }}{% if person.gens_uncertainty %}?{% endif %}
      </p>
      {% endif %}

      {% if person.review_flag %}
          <p><strong>Warning: person needs revision</strong></p>
      {% endif %}

      {% if person.dateinformation_set.all %}
      <h3>Life Dates</h3>
      <ul class="timeline no-bullet">
          {% for di in person.dateinformation_set.all %}
          <li>{{ di }}
              {% if di.notes %}
                <a href="#" class="expander life-dates right">Info <i class="fa fa-caret-right"></i></a>
                <p class="hide collapsible">{{ di.notes|capfirst }}</p>
              {% endif %}
          </li>
          {% endfor %}
      </ul>
      {% endif %}

      <div id="network-container">
        <h3>Relationships recorded in the sources</h3>
        {% comment %}
        <div id="network"></div>
        {% endcomment %}
      </div>

      <dl class="top-padding">
          {% for rel in relationships %}
          <dt class="capitalize">{{ rel.relationship }}</dt>
              <dd><a href="{% url 'person-detail' rel.related_person.id %}">{{ rel.related_person }}</a></dd>
          {% endfor %}
      </dl>

      <h3>Career</h3>
      <ul class="timeline no-bullet">
        {% for pa in person.post_assertions.all %}
        <li><span class="{% if pa.uncertain == True %}gray{% else %}green{% endif %}">{{ pa.print_date | safe }}</span> <strong>{{ pa.office | title }}</strong> {% if pa.provinces %}{{ pa.print_provinces }}{% endif %}
          {% if pa.notes.count %}
          <a href="#" class="expander right">Description <i class="fa fa-caret-right"></i></a>
          <ul class="no-bullet hide collapsible">
              {% for note in pa.notes.all %}
              <li>{{ note.text }} (in <em>{{ note.secondary_source.abbrev_name }}</em>)</li>
              {% endfor %}
          </ul>
          {% endif %}

        </li>
        {% endfor %}
    </ul>
</div>
</div>

{% endblock %}

{% block footerscripts %}
<script src="{% static 'vendor/linkurious.js/dist/sigma.min.js' %}"></script>
<script src="{% static 'vendor/linkurious.js/dist/plugins/sigma.layouts.forceLink.min.js' %}"></script>
<script src="{% static 'vendor/linkurious.js/dist/plugins/sigma.parsers.json.min.js' %}"></script>
<script src="{% static 'vendor/linkurious.js/dist/plugins/sigma.plugins.animate.min.js' %}"></script>
<script src="{% static 'vendor/linkurious.js/dist/plugins/sigma.plugins.dragNodes.min.js' %}"></script>
<script src="{% static 'vendor/linkurious.js/dist/plugins/sigma.plugins.tooltips.min.js' %}"></script>
<script src="{% static 'vendor/linkurious.js/dist/plugins/sigma.renderers.edgeLabels.min.js' %}"></script>
<script src="{% static 'vendor/linkurious.js/dist/plugins/sigma.renderers.linkurious.min.js' %}"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mustache.js/0.8.1/mustache.min.js"></script>
<script src="{% static 'javascripts/network.js' %}"></script>

<script>
    $(document).ready(function() {
        networkGraph.load({{ person.id }}, "{% url 'person-network' person.id %}");
    });
</script>
{% endblock %}