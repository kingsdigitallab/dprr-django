{% extends "base.html" %}
{% load ddh_utils_tags staticfiles wagtailbase_tags wagtailcore_tags %}

{% block meta_title %}Person Details{% endblock %}

{% block main %}

<div class="row">
    <div class="large-12 columns">

        <h1>{{ person }}</h1>

        <p>
            ID: {{ person.id }} <br />

            {% if person.patrician %}
            Patrician: {% if person.patrician_uncertainty %}?{% endif %}{{ person.patrician }} <br />
            {% endif %}
            {% if person.gens %}
            Gens: {% if person.gens_uncertainty %}?{% endif %}{{ person.gens }} <br />
            {% endif %}
        </p>

        {% if person.review_flag %}
        <p><b>Warning: person needs revision</b></p>
        {% endif %}

        {% if person.dateinformation_set.all %}
        <h2>Life Dates</h2>
        <ul>
            {% for di in person.dateinformation_set.all %}
            <li>{{ di }}</li>
            {% endfor %}
        </ul>
        {% endif %}

        <h2 class="svg-title">Relationships recorded in the sources</h2>
        <div id="network">
            <style type="text/css">
                #network {
                    width: 100%;
                    height: 600px;
                    margin: 10px;
                }
            </style>
        </div>

        <h2>Offices</h2>
        <ul class="timeline no-bullet bottom-margin">
            {% for pa in person.post_assertions.all %}
            <li><span class="label radius{% if pa.uncertain == True %} gray-bg{% else %} green-bg{% endif %}">{{ pa.print_date | safe}}</span> <strong>{{ pa.office | title}} {% if pa.provinces %} <a href="#">{{ pa.print_provinces }}</a> {% endif %}</strong>

                {% if pa.notes.count %}
                <ul class="no-bullet">
                    {% for note in pa.notes.all %}
                    <li>{{note.text}} (in <em>{{note.secondary_source.abbrev_name}}</em>)</li>
                    {% endfor %}
                </ul>
                {% endif %}

            </li>
            {% endfor %}
        </ul>
    </div>
</div>

{% endblock %}

{% block footerscripts %}
<script src="{% static 'vendor/linkurious.js/dist/sigma.min.js' %}"></script>
<script src="{% static 'vendor/linkurious.js/dist/plugins/sigma.parsers.json.min.js' %}"></script>
<script src="{% static 'vendor/linkurious.js/dist/plugins/sigma.plugins.dragNodes.min.js' %}"></script>
<script src="{% static 'vendor/linkurious.js/dist/plugins/sigma.renderers.edgeLabels.min.js' %}"></script>
<script src="{% static 'vendor/linkurious.js/dist/plugins/sigma.renderers.linkurious.min.js' %}"></script>
<script src="{% static 'javascripts/network.js' %}"></script>

<script>
    $(document).ready(function() {
        networkGraph.load({{ person.id }}, "{% url 'person-network' person.id %}");
    });
</script>
{% endblock %}