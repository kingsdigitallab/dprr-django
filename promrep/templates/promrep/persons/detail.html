{% extends "base.html" %}
{% load ddh_utils_tags staticfiles wagtailbase_tags wagtailcore_tags %}

{% block meta_title %}Person Details{% endblock %}

{% block main %}

<div class="row">
    <div class="large-12 columns">

      <h1>{{ person }}</h1>

      <p>
          Project ID: {{ person.id }}
      </p>

      {% if person.patrician %}
      <p>
          Patrician{% if person.patrician_uncertainty %}?{% endif %}
      </p>
      {% endif %}

      {% if person.gens %}
      <p>
          Gens: {{ person.gens }}{% if person.gens_uncertainty %}?{% endif %}
      </p>
      {% endif %}

      {% if person.review_flag %}
          <p><strong>Warning: person needs revision</strong></p>
      {% endif %}

      {% if person.dateinformation_set.all %}
      <h2>Life Dates</h2>
      <ul>
          {% for di in person.dateinformation_set.all %}
          <li>{{ di }}
              {% if di.notes %}
                <a href="#" class="small button round less-padding expander life-dates right">Info <i class="fa fa-caret-right"></i></a>
                <p class="hide collapsible">{{ di.notes|capfirst }}</p>
              {% endif %}
          </li>
          {% endfor %}
      </ul>
      <span class="info show"><i class="fa fa-info-circle"></i> Click to display life dates</span>
      {% endif %}

      <div id="network-container">
        <h2 class="svg-title">Relationships recorded in the sources</h2>
        <div id="network"></div>
      </div>

      <dl>
          {% for rel in relationships %}
          <dt>{{ rel.relationship }}</dt>
              <dd>{{ rel.related_person }}</dd>
          {% endfor %}
      </dl>

      <h2>Offices</h2>
      <ul class="timeline no-bullet bottom-margin">
        {% for pa in person.post_assertions.all %}
        <li><span class="label radius{% if pa.uncertain == True %} gray-bg{% else %} green-bg{% endif %}">{{ pa.print_date | safe }}</span> <strong>{{ pa.office | title }} {% if pa.provinces %} <a href="#">{{ pa.print_provinces }}</a> {% endif %}</strong>
          <a href="#" class="expander right">Description <i class="fa fa-caret-right"></i></a>
            {% if pa.notes.count %}
            <ul class="no-bullet hide collapsible">
                {% for note in pa.notes.all %}
                <li>{{note.text}} (in <em>{{note.secondary_source.abbrev_name}}</em>)</li>
                {% endfor %}
            </ul>
            {% endif %}

        </li>
        {% endfor %}
    </ul>
</div>
</div>

{% endblock %}

{% block footerscripts %}
<script src="{% static 'vendor/linkurious.js/dist/sigma.min.js' %}"></script>
<script src="{% static 'vendor/linkurious.js/dist/plugins/sigma.layouts.forceLink.min.js' %}"></script>
<script src="{% static 'vendor/linkurious.js/dist/plugins/sigma.parsers.json.min.js' %}"></script>
<script src="{% static 'vendor/linkurious.js/dist/plugins/sigma.plugins.animate.min.js' %}"></script>
<script src="{% static 'vendor/linkurious.js/dist/plugins/sigma.plugins.dragNodes.min.js' %}"></script>
<script src="{% static 'vendor/linkurious.js/dist/plugins/sigma.plugins.tooltips.min.js' %}"></script>
<script src="{% static 'vendor/linkurious.js/dist/plugins/sigma.renderers.edgeLabels.min.js' %}"></script>
<script src="{% static 'vendor/linkurious.js/dist/plugins/sigma.renderers.linkurious.min.js' %}"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mustache.js/0.8.1/mustache.min.js"></script>
<script src="{% static 'javascripts/network.js' %}"></script>

<script>
    $(document).ready(function() {
        networkGraph.load({{ person.id }}, "{% url 'person-network' person.id %}");
    });
</script>
{% endblock %}