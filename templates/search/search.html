{% extends "base.html" %}
{% load ddh_utils_tags wagtailbase_tags wagtailcore_tags %}

{% block meta_title %}Search Results{% if query %} for {{ query }}{% endif %}{% endblock %}

{% block main %}
<div class="row">
    <div class="large-3 columns facets">
        <form method="get" action=".">

            <section data-section="non-expandable" data-expandable-group-member="facets" class="expandable-list fixed-open" id="dprr-filter">

            <div class="list-item no">
              <div class="list-header no-link">
                <h4>Filter by Post Date</h4>
                    {{ form.post_date.errors }}
                    <p>{{ form.post_date }}</p>
                    <input type="submit" value="Update search">
                </div>
            </div>


            {% for facet in facets.fields %}
            <div class="list-item no">
                <div class="list-header no-link">
                    <h4>Filter by {{ facet }}</h4>
                </div>
                <div class="list-content">
                    <ul>
                        {% for term in facets.fields|get_item:facet %}
                        {% with value=term.0 count=term.1 %}
                        {% if count > 0 %}
                        <li>
                            <a href="{% add_facet_link querydict facet value %}">
                                {{ value }}
                                <span class="label radius right">{{ count }}</span>
                            </a>
                        </li>
                        {% endif %}
                        {% endwith %}
                        {% endfor %}
                    </ul>
                </div>
            </div>
            {% endfor %}
        </section>
    </form>
</div>

<div class="large-9 columns">
    <h1>Search Results</h1>
    <h2>Total persons found: {{ paginator.count }}</h2>

    {% if selected_facets %}
    <div class="large-12 columns">
        <dl class="dl-horizontal">
            <dt><span class="inline-title">Filtering By: </span></dt>
            <dd>
            {% for facet in selected_facets %}
            <span class="facet-selected">{{ facet }}
                <a href="{% remove_facet_link querydict facet %}">
                    <i class="icon icon-remove">x</i>
                </a>
             </span>
             {% endfor %}
            </dd>
        </dl>
    </div>
    {% endif %}

    <ul class="search-results">
        {% for result in object_list %}
        {% with doc=result.documents.0 %}
        <li>
            <a href="{% url 'person-detail' doc.person_id %}">{{ doc.person }}</a>
        </li>
        {% endwith %}
        {% empty %}
        <li>No results found!</li>
        {% endfor %}
    </ul>

    {% display_pagination querydict page_obj %}
</div>

</div>
{% endblock main %}
